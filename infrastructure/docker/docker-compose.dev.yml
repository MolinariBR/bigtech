# Baseado em: 3.Structure.md v1.1
# Precedência: 1.Project → 2.Architecture → 3.Structure
# Decisão: Docker Compose para desenvolvimento local

version: '3.8'

services:
  # Appwrite (já configurado separadamente)
  # Este compose foca nos serviços da aplicação BigTech

  # Frontend User (Desenvolvimento)
  frontend-user-dev:
    build:
      context: ../../frontend-app
      dockerfile: Dockerfile.dev
    container_name: frontend-user-dev
    restart: unless-stopped
    networks:
      - bigtech-dev
    environment:
      - NEXT_PUBLIC_APPWRITE_ENDPOINT=http://host.docker.internal:80
      - NEXT_PUBLIC_APPWRITE_PROJECT=bigtech
      - NODE_ENV=development
    volumes:
      - ../../frontend-app:/app
      - /app/node_modules
    ports:
      - "3000:3000"
    command: npm run dev

  # Frontend Admin (Desenvolvimento)
  frontend-admin-dev:
    build:
      context: ../../frontend-admin
      dockerfile: Dockerfile.dev
    container_name: frontend-admin-dev
    restart: unless-stopped
    networks:
      - bigtech-dev
    environment:
      - NEXT_PUBLIC_APPWRITE_ENDPOINT=http://host.docker.internal:80
      - NEXT_PUBLIC_APPWRITE_PROJECT=bigtech
      - NODE_ENV=development
    volumes:
      - ../../frontend-admin:/app
      - /app/node_modules
    ports:
      - "3001:3001"
    command: npm run dev

  # Backend Core (Desenvolvimento)
  backend-core-dev:
    build:
      context: ../../backend
      dockerfile: Dockerfile.dev
    container_name: backend-core-dev
    restart: unless-stopped
    networks:
      - bigtech-dev
    environment:
      - APPWRITE_ENDPOINT=http://host.docker.internal:80
      - APPWRITE_PROJECT_ID=bigtech
      - APPWRITE_API_KEY=${APPWRITE_API_KEY}
      - NODE_ENV=development
      - TENANT_ID=default
    volumes:
      - ../../backend:/app
      - /app/node_modules
    ports:
      - "4000:4000"
    command: npm run dev

networks:
  bigtech-dev:
    driver: bridge