# Projeto Bigtech — Tasks (Tasks)
precedence: 7
version: 1.32.0
depends_on: [1.Project.md,2.Architecture.md,3.Structure.md,4.Entities.md,5.Pages.md,6.UserStories.md]
influences: [8.DesignSystem.md,8.Tests.md]
last_update: 2025-12-24

## Índice dos Documentos

- [1.Project.md](1.Project.md) - Visão geral do projeto
- [2.Architecture.md](2.Architecture.md) - Arquitetura técnica
- [3.Structure.md](3.Structure.md) - Estrutura do projeto
- [4.Entities.md](4.Entities.md) - Modelos de dados (entidades)
- [5.Pages.md](5.Pages.md) - Páginas e interfaces
- [6.UserStories.md](6.UserStories.md) - User Stories
- [7.Tasks.md](7.Tasks.md) - Tasks de implementação
- [8.DesignSystem.md](8.DesignSystem.md) - Design System

## 1. Introdução

Este documento define as Tasks do Projeto Bigtech, baseado na análise integrada dos documentos 1.Project.md a 6.UserStories.md. As Tasks quebram as User Stories em unidades executáveis, garantindo cobertura completa do MVP, isolamento multi-tenant e extensibilidade via plugins. Cada Task inclui descrição, referências e testes property-based para validação.

As Tasks são priorizadas para desenvolvimento incremental, com foco em CORE, frontends, plugins e infraestrutura.

## 2. Tasks

### Setup e Infraestrutura
- [x] TASK-001. Configurar Ambiente de Desenvolvimento
  - Configurar repositórios Git, monorepo com workspaces, dependências globais (Node.js, Docker, Appwrite CLI).
  - User Story Relacionada: Todas (base para implementação)
  - Entidades: N/A
  - Páginas: N/A
  - Funcionalidades: Setup inicial
  - Endereço Físico: RAIZ/package.json, docker-compose.yml
  - _Requisitos: 1.1, 2.1, 3.1

  - [x] TASK-001.1 Escrever testes property-based para TASK-001
    - **Propriedade 1: Ambiente inicializa sem erros**
    - **Valida: Requisito 1.1**

- [x] TASK-002. Configurar Appwrite Backend
  - Instalar e configurar Appwrite localmente, criar collections para entidades (tenants, users, etc.).
  - User Story Relacionada: Todas (persistência)
  - Entidades: Tenant, User, Plugin, Consulta, Billing, Audit
  - Páginas: N/A
  - Funcionalidades: Persistência de dados
  - Endereço Físico: infrastructure/docker/docker-compose.prod.yml
  - _Requisitos: 2.4, 4.6

  - [x] TASK-002.1 Escrever testes property-based para TASK-002
    - **Propriedade 1: Collections criadas com isolamento por tenant**
    - **Valida: Requisito 2.4**

- [x] TASK-003. Implementar Containers Docker
  - Criar Dockerfiles para frontends, backend e plugins; configuração para deploy compartilhado.
  - User Story Relacionada: Todas (deploy)
  - Entidades: N/A
  - Páginas: N/A
  - Funcionalidades: Deploy da aplicação
  - Endereço Físico: infrastructure/docker/docker-compose.prod.yml
  - _Requisitos: 2.5, 3.4

  - [x] TASK-003.1 Escrever testes property-based para TASK-003
    - **Propriedade 1: Deploy compartilhado sem isolamento por tenant**
    - **Valida: Requisito 2.5**

### Autenticação e CORE
- [x] TASK-004. Implementar Autenticação de Usuário
  - Desenvolver módulo de auth no CORE, integração com Appwrite JWT, validação CPF/CNPJ.
  - User Story Relacionada: US-001
  - Entidades: User
  - Páginas: / (frontend-app), / (frontend-admin)
  - Funcionalidades: Autenticação via CORE
  - Endereço Físico: backend/src/core/auth.ts
  - _Requisitos: 2.1, 5.1

  - [x] TASK-004.1 Escrever testes property-based para TASK-004
    - **Propriedade 1: JWT válido para usuários isolados por tenant**
    - **Valida: Requisito 2.1**

- [x] TASK-005. Implementar Autenticação de Administrador
  - Similar a TASK-004, com validação de role admin.
  - User Story Relacionada: US-007
  - Entidades: User
  - Páginas: / (frontend-admin)
  - Funcionalidades: Autenticação via CORE
  - Endereço Físico: backend/src/core/auth.ts
  - _Requisitos: 2.1, 5.1

  - [x] TASK-005.1 Escrever testes property-based para TASK-005
    - **Propriedade 1: Acesso negado para roles não-admin**
    - **Valida: Requisito 2.1**

### Funcionalidades de Usuário
- [x] TASK-006. Desenvolver Dashboard de Usuário
  - Página com Header (navegação superior), Sidebar (menu lateral), Footer (copyright), cards superiores (saldo disponível, saldo anterior, saldo bloqueado, última atualização), cards secundários para acesso rápido a consultas (crédito, cadastral, veicular), e tabela com últimas consultas realizadas. Componentes: Card, Button, Header, Sidebar, Footer. Integração com entidades User e Consulta.
  - User Story Relacionada: US-002
  - Entidades: User, Consulta
  - Páginas: / (frontend-app)
  - Funcionalidades: Exibição de métricas, navegação completa
  - Componentes: Card, Button, Header, Sidebar, Footer (8.DesignSystem.md, 5.Pages.md)
  - Endereço Físico: frontend-app/src/pages/index.tsx
  - _Requisitos: 5.3.1, 4.2, 8.1, 8.2, 8.3

  - [x] TASK-006.1 Escrever testes property-based para TASK-006
    - **Propriedade 1: Dados exibidos corretamente por tenant**
    - **Valida: Requisito 4.2**

- [x] TASK-007. Implementar Consulta Crédito
  - Página com cards de consultas de crédito disponíveis via plugins ativos (ex.: POSITIVO ACERTA ESSENCIAL PF, PROTESTO SINTÉTICO NACIONAL), cada card com título, descrição, preço e botão para executar. Modal para input de dados (CPF/CNPJ), validação de créditos, execução via plugin e fallback automático.
  - User Story Relacionada: US-003
  - Entidades: Consulta, Plugin
  - Páginas: /consulta/credito (frontend-app)
  - Funcionalidades: Execução via plugin consulta, validação e fallback
  - Componentes: Card, Modal (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/consulta/credito.tsx, backend/src/plugins/consulta/infosimples/index.ts
  - _Requisitos: 5.3.2, 2.3

  - [x] TASK-007.1 Escrever testes property-based para TASK-007
    - **Propriedade 1: Resultado normalizado independente da fonte**
    - **Valida: Requisito 2.3**

- [x] TASK-008. Implementar Consulta Cadastral
  - Página com cards de consultas cadastrais disponíveis via plugins ativos (ex.: QUOD CADASTRAL PF, RELATÓRIO JURIDICO PF), cada card com título, descrição, preço e botão para executar. Modal para input de dados (CPF/CNPJ), validação de créditos, execução via plugin e fallback automático.
  - User Story Relacionada: US-004
  - Entidades: Consulta, Plugin
  - Páginas: /consulta/cadastral (frontend-app)
  - Funcionalidades: Execução via plugin consulta
  - Componentes: Card, Modal (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/consulta/cadastral.tsx
  - _Requisitos: 5.3.3, 2.3

  - [x] TASK-008.1 Escrever testes property-based para TASK-008
    - **Propriedade 1: Fallback automático em falha de fonte**
    - **Valida: Requisito 2.3**

- [x] TASK-008.2 Implementar Consulta Veicular
  - Página com cards de consultas veiculares disponíveis via plugins ativos (ex.: BIN NACIONAL COMPLETA, CRLV por estado), cada card com título, descrição, preço e botão para executar. Modal para input de dados (placa), validação de créditos, execução via plugin e fallback automático. Suporte a documentos específicos por estado.
  - User Story Relacionada: US-004.1
  - Entidades: Consulta, Plugin
  - Páginas: /consulta/veicular (frontend-app)
  - Funcionalidades: Execução via plugin consulta
  - Componentes: Card, Modal (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/consulta/veicular.tsx
  - _Requisitos: 5.3.4, 2.3

- [x] TASK-008.2.1 Escrever testes property-based para TASK-008.2
    - **Propriedade 1: Validação de formato de placa e normalização de dados veiculares**
    - **Valida: Requisito 2.3**

- [x] TASK-009. Desenvolver Relatório de Consultas
  - Página com tabela exibindo consultas realizadas (Consulta.type, Consulta.executedAt, Consulta.cost, Consulta.status), filtros por data, tipo (crédito, cadastral, veicular) e status (success, failed), detalhes expandidos (Consulta.input, Consulta.output), exportação opcional (CSV/JSON). Componentes: Table, Button (8.DesignSystem.md). Isolamento por tenant (apenas consultas do usuário), performance com lazy loading.
  - User Story Relacionada: US-005
  - Entidades: Consulta
  - Páginas: /relatorios/consultas (frontend-app)
  - Funcionalidades: Relatório e filtros
  - Endereço Físico: frontend-app/src/pages/relatorios/consultas.tsx
  - _Requisitos: 5.3.5, 4.4

  - [x] TASK-009.1 Escrever testes property-based para TASK-009
    - **Propriedade 1: Consultas filtradas por tenant e usuário**
    - **Valida: Requisito 4.4**

- [x] TASK-010. Implementar Compra de Créditos
  - Página de seleção de valor de créditos (modelo pré-pago), com input para quantidade desejada, validação de valores mínimos/máximos (configuráveis via frontend-admin), cálculo automático do total, modal para confirmação e integração com plugin pagamento. Inclui seleção de créditos por valor, integração com Asaas/Pagarme, confirmação via webhook que atualiza User.credits, histórico de transações em Billing, validação de pagamento antes de crédito, notificações de sucesso/erro e modal para confirmação de compra.
  - User Story Relacionada: US-006
  - Entidades: Billing, User
  - Páginas: /financeiro/comprar (frontend-app)
  - Funcionalidades: Integração com plugin pagamento, validação pré-paga, atualização de créditos
  - Componentes: Input, Button, Modal (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/financeiro/comprar.tsx, backend/src/plugins/pagamentos/asaas/index.ts
  - _Requisitos: 5.3.6, 2.3, 8.1, 8.2

  - [x] TASK-010.1 Escrever testes property-based para TASK-010
    - **Propriedade 1: Créditos atualizados após pagamento confirmado via webhook**
    - **Propriedade 2: Validação de valores mínimos e máximos configuráveis**
    - **Propriedade 3: Cálculo automático do total correto**
    - **Propriedade 4: Notificações de sucesso/erro enviadas**
    - **Propriedade 5: Histórico de transações registrado em Billing**
    - **Valida: Requisito 2.3**

- [x] TASK-010.2 Implementar Extrato Financeiro
  - Página de listagem de transações com filtros, detalhes expandidos e isolamento por tenant.
  - User Story Relacionada: US-006.1
  - Entidades: Billing
  - Páginas: /financeiro/extrato (frontend-app)
  - Funcionalidades: Listagem de transações
  - Componentes: Table, Button (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/financeiro/extrato.tsx
  - _Requisitos: 5.3, 4.1

  - [x] TASK-010.2.1 Escrever testes property-based para TASK-010.2
    - **Propriedade 1: Transações isoladas por tenant**
    - **Valida: Requisito 4.1**

- [x] TASK-010.3 Implementar Boletos e Faturas
  - Página de listagem de boletos com download e notificações de vencimento.
  - User Story Relacionada: US-006.2
  - Entidades: Billing
  - Páginas: /financeiro/boletos (frontend-app)
  - Funcionalidades: Listagem e download
  - Componentes: Table, Button (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/financeiro/boletos.tsx
  - _Requisitos: 5.3, 4.1

  - [x] TASK-010.3.1 Escrever testes property-based para TASK-010.3
    - **Propriedade 1: Boletos acessíveis apenas ao usuário**
    - **Valida: Requisito 4.1**

- [x] TASK-010.4 Implementar Aviso LGPD
  - Página estática com texto de privacidade, consentimento opcional e links para política completa.
  - User Story Relacionada: US-006.3
  - Entidades: N/A
  - Páginas: /lgpd (frontend-app)
  - Funcionalidades: Página estática
  - Componentes: Button (8.DesignSystem.md)
  - Endereço Físico: frontend-app/src/pages/lgpd.tsx
  - _Requisitos: 5.3, 4.6

  - [x] TASK-010.4.1 Escrever testes property-based para TASK-010.4
    - **Propriedade 1: Conteúdo imutável e acessível**
    - **Valida: Requisito 4.6**

### Gestão Administrativa
- [x] TASK-011. Desenvolver Dashboard Administrativo
  - Página com métricas globais (tenants ativos, consumo total, usuários, consultas), gráficos de uso via Recharts, alertas em tempo real, links para gestão de tenants/plugins/billing/audit, atualização automática via polling. Usa mock data para MVP, componentes Card, Button, Alert do Shadcn/UI.
  - User Story Relacionada: US-008
  - Entidades: Tenant, Billing
  - Páginas: / (frontend-admin)
  - Funcionalidades: Métricas e gráficos
  - Componentes: Card, Button, Alert (8.DesignSystem.md), Recharts (extensão)
  - Endereço Físico: frontend-admin/src/pages/index.tsx
  - _Requisitos: 5.3.6, 4.5

  - [x] TASK-011.1 Escrever testes property-based para TASK-011
    - **Propriedade 1: Dados agregados corretamente por tenant (simulação mockada)**
    - **Valida: Requisito 4.5**

- [x] TASK-012. Implementar Gestão de Tenants
  - Página de gestão de tenants (/tenants no frontend-admin) com lista de tenants, filtros por status/nome, paginação, formulários para criação/edição (campos: name, status, plugins[], settings), ações de ativação/desativação, validação de unicidade (Tenant.name), isolamento visual por tenant, links para plugins/billing do tenant selecionado, confirmações para ações críticas, notificações para mudanças. Componentes: Table para listagem, Modal para formulários, Button para ações. Integração com entidade Tenant, isolamento multi-tenant, logs de auditoria (Audit).
  - User Story Relacionada: US-009
  - Entidades: Tenant, Audit
  - Páginas: /tenants (frontend-admin)
  - Funcionalidades: CRUD de tenants, ativação/desativação, validação unicidade, isolamento visual
  - Endereço Físico: frontend-admin/src/pages/tenants.tsx, backend/src/core/audit.ts
  - _Requisitos: 5.3.7, 4.1, 4.6

  - [x] TASK-012.1 Escrever testes property-based para TASK-012
    - **Propriedade 1: Tenants únicos e isolados por tenantId**
    - **Propriedade 2: Unicidade de Tenant.name validada**
    - **Propriedade 3: Logs de auditoria gerados para ações de CRUD**
    - **Valida: Requisito 4.1, 4.6

- [ ] TASK-013. Desenvolver Gestão de Plugins (Docs-First)
  - **ATENÇÃO (DOCS-FIRST):** Antes de implementar, executar leitura e alinhamento dos documentos na ordem de precedência: `1.Project.md` → `2.Architecture.md` → `4.Entities.md` → `5.Pages.md` → `8.DesignSystem.md` (ver seção `6.9 Componentes para Gestão de Plugins`). Todas as discrepâncias devem ser resolvidas nos documentos antes de qualquer alteração de código.
  - Página de gestão de plugins (/plugins no frontend-admin) com lista de plugins instalados/ativos por tenant, filtros por tenant/tipo, toggles para enable/disable (Plugin.status), configuração via modais (Plugin.config, ex.: apiKey, fallbackSources), validação de dependências entre plugins, ações instalar novo plugin/atualizar versão/remover, notificações de mudanças de plugins, logs de mudanças (Audit). Componentes: Table para listagem, Modal para configuração, Button para ações. Integração com entidade Plugin, isolamento multi-tenant, pluginLoader para ativação dinâmica.
  - User Story Relacionada: US-010
  - Entidades: Plugin, Tenant, Audit
  - Páginas: /plugins (frontend-admin)
  - Funcionalidades: Ativação via pluginLoader, configuração, validação dependências, deploy notifications
  - Endereço Físico: frontend-admin/src/pages/plugins.tsx, backend/src/core/pluginLoader.ts
  - _Requisitos: 5.3.8, 2.3, 4.6

  - **Docs Alinhados:** `1.Project.md`, `2.Architecture.md`, `3.Structure.md`, `4.Entities.md`, `5.Pages.md`, `6.UserStories.md`, `8.DesignSystem.md#6.9` foram atualizados para especificar validação de schema, emissão de `auditId`, dependências de plugins e padrões de UI. Verifique os arquivos citados antes de prosseguir.

  - [ ] TASK-013.1 Escrever testes property-based para TASK-013 (após correção de docs)
    - **Propriedade 1: Plugins ativados sem conflitos de dependências**
    - **Propriedade 2: Configurações de plugins validadas e aplicadas**
    - **Propriedade 3: Logs de auditoria gerados para mudanças de plugins (inclui `auditId`)**
    - **Valida: Requisito 2.3, 4.6

 - [ ] TASK-014. Implementar Monitoramento de Billing (Docs-First)
  - **ATENÇÃO (DOCS-FIRST):** Antes de implementar, alinhar e validar os documentos na ordem de precedência: `1.Project.md` → `2.Architecture.md` → `3.Structure.md` → `4.Entities.md` → `5.Pages.md` → `6.UserStories.md` → `8.DesignSystem.md`. Todas as decisões de API, esquema de dados, retenção, agregação e alertas devem estar documentadas e versionadas antes de qualquer alteração de código.
  - Escopo: Painel/relatórios de Billing com filtros, agregações, exportação, reembolso (refund) e integração com observabilidade (Prometheus/Grafana) e alertas.
  - User Story Relacionada: US-011
  - Entidades: Billing (expandir 4.Entities.md com campos: `id`, `tenantId`, `userId?`, `type`, `amount`, `currency`, `status`, `metadata?`, `createdAt`, `settledAt?`, `referenceId?`, `externalProvider?`, `tags?`, `retentionPolicy?`), Audit
  - Páginas: /billing (frontend-admin)
  - Funcionalidades:
    - Listagem paginada e filtrável por `date range`, `tenantId`, `type` (purchase, refund, chargeback), `status` (pending, settled, refunded, failed), `userId`, `referenceId`.
    - Agregações (soma, média, contagem) por período (dia/semana/mês) com opção de granularidade configurável.
    - Exportação de conjuntos filtrados (CSV/NDJSON/JSON) via job assíncrono com resposta por URL assinado ou fila (s3/presigned). Backend deve suportar `POST /api/admin/billing/export` que retorna jobId e depois URL quando pronto.
    - Reembolso: endpoint seguro `POST /api/admin/billing/{id}/refund` que altera `status` e emite evento de auditoria com `auditId`.
    - Audit trail: link para visualização de `Audit` para cada transação (emitir `auditId` em todas operações mutativas).
    - UI: gráficos de tendência, tabela com paginação/colunas configuráveis, DateRangePicker, botões `Export`, `Refund`, `Details` e toasts/alerts para status de jobs.
  - Endereço Físico (sugerido): backend/src/controllers/admin/billing.ts, backend/src/core/billingEngine.ts, frontend-admin/src/pages/billing.tsx
  - API contratada (documentar em 2.Architecture.md / 5.Pages.md):
    - `GET /api/admin/billing?tenantId=&page=&perPage=&from=&to=&type=&status=&userId=&referenceId=` → lista paginada (retornar total, page, perPage, items[])
    - `GET /api/admin/billing/aggregates?tenantId=&from=&to=&granularity=day|week|month&metrics=sum|avg|count` → retornos séries temporais
    - `POST /api/admin/billing/export` (body: filtros, format, notifyEmail?) → { jobId }
    - `GET /api/admin/billing/export/{jobId}` → { status, url? }
    - `POST /api/admin/billing/{id}/refund` (body: {reason, amount?}, headers: `X-Audit-Id`) → mutação segura que emite Audit
  - Observabilidade e Alertas (documentar em 2.Architecture.md):
    - Métricas Prometheus a expor: `billing_transactions_total`, `billing_revenue_sum`, `billing_refunds_total`, `billing_failed_total`, `billing_processing_latency_seconds` (histogram).
    - Regras de alerta sugeridas (Grafana/Alertmanager): queda de receita percentual em 24h (> X%), taxa de falha de transações > Y%, jobs de exportação em erro > Z por hora.
    - Logs estruturados (JSON) com `auditId`, `tenantId`, `requestId`, `traceId` para correlação distribuída.
  - Retenção e Governança (documentar em 4.Entities.md / 2.Architecture.md):
    - Política de retenção configurável por tenant (e.g., 7 dias para transações pendentes, 365 dias para settled), com rotina de arquivamento/export para armazenamento frio (S3) e deleção segura.
    - Dados exportados devem incluir metadados de auditoria e versão do schema.
  - Design System (referenciar 8.DesignSystem.md): componentes necessários: `Table`, `DateRangePicker`, `Chart/Timeseries`, `ExportButton` (com estado job), `ConfirmModal` (refund), `Toast/Alert`, `FilterBar`.
  - Testes property-based (Docs-first) — TASK-014.1 (detalhar em 8.Tests.md):

    - [ ] TASK-014.1 Escrever testes property-based para TASK-014 (implementar APÓS documentação completa)
      - **Propriedade 1:** Agregações (sum/avg/count) são consistentes com a soma dos itens subjacentes para qualquer conjunto filtrado e granularidade.
      - **Propriedade 2:** Export contém exatamente as linhas retornadas pela query filtrada e com checksum/verificação (e.g., SHA256) consistente.
      - **Propriedade 3:** Reembolso transita `status` corretamente e o `amount` reembolsado não excede o disponível; operações geram `Audit` com `auditId` único.
      - **Propriedade 4:** Jobs de exportação lidam com concorrência e não perdem registros (idempotência do job).
      - **Propriedade 5:** Retenção aplicada — dados fora do período configurado são arquivados/deletados conforme política.
      - **Valida:** Requisitos 5.3.9, 4.5, 4.6
  - _Notas de Implementação:_
    - Todas as APIs mutativas devem aceitar/emitir `X-Audit-Id` ou `auditId` no payload/headers para rastreabilidade (conforme 1.Project.md).
    - Backend deve publicar eventos no EventBus (`billing.transaction.created`, `billing.refund.initiated`, `billing.export.requested`) para integração com billingEngine e observability pipelines.
    - Documentar formatos de payload e exemplos em `Docs/5.Pages.md` e `Docs/2.Architecture.md` antes de qualquer implementação.
  - _Requisitos:_ 5.3.9, 4.5, 4.6

- [x] TASK-015. Desenvolver Auditoria de Ações
  - Logs de auditoria com filtros, geração automática para ações administrativas e operacionais (consultas, plugins, billing, tenants). Página com lista de logs, filtros por tenant/usuário/ação/período, detalhes expandidos, exportação para compliance. Integração com entidade Audit, isolamento multi-tenant, logs imutáveis. Componentes: AuditTable, AuditFilters, AuditDetailsModal (8.DesignSystem.md#6.11).
  - User Story Relacionada: US-012
  - Entidades: Audit
  - Páginas: /audit (frontend-admin)
  - Funcionalidades: Geração automática de logs, filtros e exportação
  - Endereço Físico: frontend-admin/src/pages/audit.tsx, backend/src/core/audit.ts
  - _Requisitos: 5.3.10, 4.6, 2.6 (auditoria em 2.Architecture.md)

  - [x] TASK-015.1 Escrever testes property-based para TASK-015
    - **Propriedade 1: Logs imutáveis após criação (campos não alteráveis)**
    - **Propriedade 2: Rastreabilidade por tenant/usuário (filtros retornam logs corretos)**
    - **Valida: Requisito 4.6, 8.Tests.md**

### Plugins e Extensibilidade (https://infosimples.com/consultas/)
-- [x] TASK-016. Implementar Plugin Consulta Infosimples (https://infosimples.com/consultas/)
  - Módulo para consultas via Infosimples API, orquestrando fontes de dados e normalizando respostas para categorias crédito, cadastral e veicular.
  - User Story Relacionada: US-003, US-004, US-004.1
  - Entidades: Consulta, Plugin
  - Páginas: N/A
  - Funcionalidades: Execução de consulta, normalização de dados
  - Endereço Físico: backend/src/plugins/consulta/infosimples/index.ts
  - _Requisitos: 2.3, 4.7

  - [x] TASK-016.1 Escrever testes property-based para TASK-016
    - **Propriedade 1: Dados de fontes externas (ex.: Infosimples) são normalizados consistentemente para schema padrão, independente de variações na API**
    - **Valida: Requisito 4.7**

- [x] TASK-017. Implementar Plugin Pagamento Asaas (https://docs.asaas.com/docs/visao-geral)
  - Plugin de pagamento para integração com Asaas API, suportando criação de clientes, geração de pagamentos (PIX, Boleto, Cartão), processamento de webhooks para confirmação, registro automático em Billing e atualização de créditos do usuário. Inclui validação de métodos de pagamento suportados, rollback em falhas, isolamento multi-tenant e contratos padronizados de plugin (install, enable, disable, execute). Funcionalidades: criação/orçamento de clientes Asaas, geração de cobranças com métodos PIX/Boleto/Cartão, handler de webhooks para eventos PAYMENT_RECEIVED/CONFIRMED, registro de transações em Billing com status pending/completed, atualização automática de User.credits após confirmação, validação de valores mínimos/máximos e métodos suportados, mapeamento de status Asaas para interno, notificações via EventBus. Componentes: AsaasPlugin class, PaymentContext interface, AsaasPaymentResponse, AsaasWebhookData, AsaasPluginConfig, handleAsaasWebhook function. Endereços físicos: backend/src/plugins/pagamentos/asaas/index.ts, backend/src/plugins/pagamentos/asaas/types.ts, backend/src/plugins/pagamentos/asaas/config.ts, backend/tests/plugin-asaas.test.ts.
  - User Story Relacionada: US-006
  - Entidades: Billing, User
  - Páginas: /financeiro/comprar (frontend-app)
  - Funcionalidades: Integração com gateway Asaas, processamento de pagamentos, webhooks, atualização de créditos
  - Endereço Físico: backend/src/plugins/pagamentos/asaas/index.ts, backend/src/plugins/pagamentos/asaas/types.ts, backend/src/plugins/pagamentos/asaas/config.ts
  - _Requisitos: 2.3, 4.8

  - [x] TASK-017.1 Escrever testes property-based para TASK-017
    - **Propriedade 1: Transações únicas - externalTransactionId não permite duplicatas**
    - **Propriedade 2: Rollback em falha - status permanece pending se webhook falha**
    - **Propriedade 3: Créditos adicionados apenas após confirmação via webhook**
    - **Propriedade 4: Validação de métodos de pagamento suportados**
    - **Propriedade 5: Mapeamento correto de status Asaas para status interno**
    - **Valida: Requisito 4.8**

- [ ] TASK-018. Implementar Página de Configurações Globais
  - Página /settings no frontend-admin com abas para configurações de sistema (rate limits, temas padrão, timeouts), plugins globais (valores padrão, fallbacks), billing (mínimos/máximos, retenção) e auditoria (retenção, alertas). Formulários com validação em tempo real, confirmação modal para salvar, exibição de auditId após mudanças. Componentes: Tabs, Form, Input, Select, Switch, Modal (8.DesignSystem.md). Integração com CORE para validação e aplicação dinâmica.
  - User Story Relacionada: US-013
  - Entidades: Tenant.settings, Plugin.config
  - Páginas: /settings (frontend-admin)
  - Funcionalidades: Configurações globais com validação e auditId
  - Endereço Físico: frontend-admin/src/pages/settings.tsx
  - _Requisitos: 5.3.11, 4.6

  - [x] TASK-019. Implementar Configuração de Parâmetros Globais do Sistema
  - Página /settings no frontend-admin com abas para configurações de billing (min/max compra, valor por crédito, retenção), email (from, reply-to, support), SMTP (host, port, credenciais), rates (rate limit padrão, multiplicador fallback). Formulários com validação em tempo real, confirmação modal para salvar, exibição de auditId após mudanças. Componentes: Tabs, Form, Input, Select, Switch, Modal (8.DesignSystem.md). Integração com entidade SystemSettings, isolamento global, aplicação dinâmica.
  - Criar collection "systemSettings" no Appwrite com documento único (id: "global") contendo os campos billing, email, smtp, rates.
  - User Story Relacionada: US-014
  - Entidades: SystemSettings
  - Páginas: /settings (frontend-admin)
  - Funcionalidades: Configurações globais com validação e auditId
  - Endereço Físico: frontend-admin/src/pages/settings.tsx, backend/src/controllers/admin/systemSettings.ts
  - _Requisitos: 5.3.11, 4.6

  - [x] TASK-019.1 Escrever testes property-based para TASK-019
    - **Propriedade 1: Configurações validadas contra schema antes de aplicação**
    - **Propriedade 2: Mudanças aplicadas dinamicamente sem restart**
    - **Propriedade 3: AuditId gerado para cada mudança de configuração**
    - **Valida: Requisito 4.6**

## 3. Cobertura do Projeto

As Tasks acima cobrem:
- **Setup**: TASK-001 a TASK-003
- **CORE**: TASK-004, TASK-005
- **Usuário**: TASK-006 a TASK-010.4 (dashboard, consultas por categoria, relatórios, financeiro subdividido, LGPD)
- **Admin**: TASK-011 a TASK-015, TASK-018 (dashboard, tenants, plugins, billing, audit, configurações)
- **Plugins**: TASK-016, TASK-017
- **Testes**: Property-based para validação de propriedades críticas.

## 4. Histórico de Versões
- **Versão 1.32.0** (24/12/2025): Adição de TASK-019 e TASK-019.1 para implementação da configuração de parâmetros globais (taxas, preços, email, SMTP), alinhada com US-014 e nova entidade SystemSettings.
- **Versão 1.31.0** (24/12/2025): Adição de TASK-018 e TASK-018.1 para implementação da página de configurações globais, alinhada com US-013 e nova página /settings em 5.Pages.md.
- **Versão 1.30.0** (24/12/2025): Alinhamento completo com tenancy lógico definido em 1.Project.md a 6.UserStories.md. Correção de terminologia e remoção de referências a isolamento físico.
- **Versão 1.25** (21 de dezembro de 2025): Correção do componente Modal em frontend-admin/src/components/ui/modal.tsx para implementação simples sem dependências externas, resolvendo erro de importação. Testes property-based em backend/tests/audit.test.ts ajustados com mocks do AppwriteService para evitar rate limits e validar propriedades de imutabilidade e rastreabilidade. TASK-015 e TASK-015.1 mantidos como implementados.
- **Versão 1.24** (21 de dezembro de 2025): Implementação completa de TASK-015 (Auditoria de Ações) com página funcional /audit em frontend-admin/src/pages/audit.tsx, incluindo filtros por tenant/usuário/ação/período, tabela com detalhes expandidos, exportação CSV, modal para detalhes, isolamento multi-tenant, integração com AuditLogger em backend/src/core/audit.ts para geração automática de logs imutáveis. Testes property-based TASK-015.1 implementados em backend/tests/audit.test.ts validando imutabilidade e rastreabilidade, com ajustes necessários para rate limits do Appwrite. Build e página sem erros de TypeScript. Componentes AuditTable, AuditFilters, AuditDetailsModal criados conforme 8.DesignSystem.md#6.11.
- **Versão 1.23** (22 de dezembro de 2025): Atualização de TASK-015 e TASK-015.1 para alinhamento com correções em 2.Architecture.md (seção 3.6 Auditoria), 3.Structure.md (audit.tsx), 5.Pages.md (/audit na lista), 8.DesignSystem.md (seção 6.11 componentes de auditoria) e criação de 8.Tests.md. Detalhes expandidos para geração automática, filtros, exportação, imutabilidade e rastreabilidade. Propriedades de teste refinadas para imutabilidade e rastreabilidade.
- **Versão 1.22** (22 de dezembro de 2025): Refatoração de TASK-013 e TASK-013.1 para alinhamento completo com US-010 (6.UserStories.md), 5.3.8 (5.Pages.md), 4.Entities.md (Plugin, Tenant, Audit) e 8.DesignSystem.md (componentes Table, Modal, Button). Adição de detalhes sobre lista com filtros, toggles, configuração via modais, validação dependências, ações instalar/atualizar/remover, notificações deploy, logs auditoria, integração com pluginLoader, e propriedades de teste expandidas para validação configurações e logs. Endereço físico mantido. Requisitos atualizados para incluir 4.6 (auditoria).
- **Versão 1.21** (22 de dezembro de 2025): Implementação completa de TASK-012 (Gestão de Tenants) com página funcional em frontend-admin/src/pages/tenants.tsx, incluindo lista com filtros, formulários CRUD via Modal, validação unicidade, isolamento visual, links para plugins/billing, confirmações, notificações, integração com Audit. Criados componentes UI (Dialog, Input, Label, Select) em frontend-admin/src/components/ui/. Testes property-based TASK-012.1 implementados e validados em __tests__/tenants.test.js. Build e testes sem erros.
- **Versão 1.18** (22 de dezembro de 2025): Atualização de TASK-011 e TASK-011.1 com detalhes da implementação (Recharts para gráficos, mock data, componentes DS), adição de testes property-based validados para agregação de dados por tenant, e build/test sem erros.
- **Versão 1.17** (22 de dezembro de 2025): Implementação completa de TASK-011 (Dashboard Administrativo) com página funcional exibindo métricas globais (tenants ativos, consumo total, usuários, consultas), gráficos de uso via Recharts, alertas em tempo real, links para gestão de tenants/plugins/billing/audit, atualização automática via polling, componentes Card, Button, Alert do Shadcn/UI, isolamento multi-tenant mockado, e testes property-based para validação de agregação de dados por tenant.
- **Versão 1.16** (22 de dezembro de 2025): Correção de referências de requisitos inexistentes em TASK-016 (4.7) e TASK-017 (4.8), adicionando seções correspondentes em 4.Entities.md para alinhamento completo da documentação hierárquica.
- **Versão 1.15** (22 de dezembro de 2025): Correção de referências de requisitos inexistentes em TASK-012 (5.3.7), TASK-013 (5.3.8), TASK-014 (5.3.9), TASK-015 (5.3.10) e TASK-015.1 (4.6), adicionando seções correspondentes em 5.Pages.md e 4.Entities.md para alinhamento completo da documentação hierárquica.
- **Versão 1.14** (22 de dezembro de 2025): Correção de referências de requisitos inexistentes em TASK-011 e TASK-011.1, adicionando seções 5.3.6 em 5.Pages.md e 4.5 em 4.Entities.md para alinhamento completo da documentação hierárquica.
- **Versão 1.13** (22 de dezembro de 2025): Implementação completa de TASK-010.4 (Aviso LGPD) com página funcional de privacidade, texto explicativo sobre LGPD, consentimento opcional, links para política completa e recursos externos, componentes Button e Card, isolamento por tenant, testes property-based para validação de acessibilidade e imutabilidade, e build sem erros de TypeScript.
- **Versão 1.12** (21 de dezembro de 2025): Implementação completa de TASK-010.3 (Boletos e Faturas) com página funcional de listagem de boletos, filtros por status, download de boletos pendentes, notificações de vencimento, isolamento por tenant, componentes Table e Button, e testes property-based para validação de isolamento multi-tenant.
- **Versão 1.11** (21 de dezembro de 2025): Implementação completa de TASK-010.2 (Extrato Financeiro) com página funcional, filtros, detalhes expandidos, isolamento por tenant, componentes Table e Button, e testes property-based para validação de isolamento multi-tenant.
- **Versão 1.9** (21 de dezembro de 2025): Refatoração da TASK-010 para alinhamento completo com US-006, incluindo todos os critérios de aceite, componentes do Design System (Modal, Button), modelo pré-pago detalhado, entidade Billing expandida e testes property-based aprimorados.
- **Versão 1.8** (20 de dezembro de 2025): Correção da TASK-009 para alinhamento com 5.Pages.md, 8.DesignSystem.md e US-005, adicionando detalhes específicos da tabela (colunas Consulta.type, executedAt, cost, status), filtros (data, tipo, status), detalhes expandidos (input/output), exportação CSV/JSON, componentes Table e Button, isolamento por tenant e lazy loading.
- **Versão 1.5** (20 de dezembro de 2025): Implementação completa da TASK-008 (Consulta Cadastral) com página funcional, modal de input, validação CPF/CNPJ, execução mockada via plugin e fallback automático. Criado componente reutilizável baseado no padrão de TASK-007. Testes property-based TASK-008.1 implementados e validados, incluindo fallback, validação e normalização para dados cadastrais.
- **Versão 1.4** (20 de dezembro de 2025): Correção da TASK-008 para alinhamento com 5.Pages.md e 8.DesignSystem.md, adicionando detalhes específicos dos cards (ex.: QUOD CADASTRAL PF), modal para input, validação e fallback, e referência aos componentes Card e Modal.
- **Versão 1.3** (20 de dezembro de 2025): Implementação completa da TASK-007 (Consulta Crédito) com página funcional, modal de input, validação CPF/CNPJ, execução mockada via plugin e fallback automático. Criado componente Modal reutilizável. Testes property-based TASK-007.1 implementados e validados.
- **Versão 1.2** (20 de dezembro de 2025): Correção de nomenclatura "frontend-user" para "frontend-app" em todas as tasks para consistência com o projeto atual. Detalhamento da TASK-007 com referência aos componentes do Design System (Card, Modal) e funcionalidades específicas (validação de créditos, fallback automático) conforme 5.Pages.md e 8.DesignSystem.md.
- **Versão 1.1** (20 de dezembro de 2025): Refatoração baseada em 5.Pages.md v1.1 e 6.UserStories.md v1.1. Atualização de TASK-007 a TASK-010 para categorias e novas rotas; adição de TASK-008.2, TASK-010.2 a TASK-010.4 para novas páginas.
- **Versão 1.0** (20 de dezembro de 2025): Criação inicial do documento 7.Tasks.md baseado em 1.Project.md a 6.UserStories.md. Definição de Tasks com foco em implementação incremental e testes.
- **Versão 1.28** (21 de dezembro de 2025): Correção detalhada de TASK-017 no arquivo 7.Tasks.md, expandindo descrição para incluir funcionalidades completas do plugin Asaas (criação de clientes/pagamentos, webhooks, registro em Billing, atualização de créditos), componentes, endereços físicos e propriedades de teste refinadas baseadas em 4.Entities.md seção 4.8.
- **Versão 1.27** (21 de dezembro de 2025): Conclusão de TASK-017 (Plugin Pagamento Asaas) e TASK-017.1 (testes property-based) com implementação completa do plugin e testes alinhados a 4.Entities.md seção 4.8 (Processamento de Pagamentos), validando propriedades de transações únicas, rollback em falha, confirmação via webhook, validação de métodos e mapeamento de status.
- **Versão 1.26** (20 de dezembro de 2025): Refatoração de TASK-016 e TASK-016.1 para alinhamento com atualizações em 2.Architecture.md (fonte Infosimples), 4.Entities.md (testes property-based para normalização), 6.UserStories.md (referência a Infosimples em US-003, US-004, US-004.1). Descrição expandida para incluir orquestração e normalização, adição de US-004.1, propriedade de teste refinada para consistência de normalização independente de variações na API.
 - **Versão 1.29** (21 de dezembro de 2025): Conclusão de TASK-016 (Plugin Infosimples) — implementados retries/exponential-backoff, fallbacks (BrasilAPI, ViaCEP), timeout robusto e testes unitários/property-based. Suíte backend validada localmente.