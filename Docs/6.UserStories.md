# Projeto Bigtech — User Stories (UserStories)

## Índice dos Documentos

- [1.Project.md](1.Project.md) - Visão geral do projeto
- [2.Architecture.md](2.Architecture.md) - Arquitetura técnica
- [3.Structure.md](3.Structure.md) - Estrutura do projeto
- [4.Entities.md](4.Entities.md) - Modelos de dados (entidades)
- [5.Pages.md](5.Pages.md) - Páginas e interfaces
- [6.UserStories.md](6.UserStories.md) - User Stories
- [7.Tasks.md](7.Tasks.md) - Tasks de implementação
- [8.DesignSystem.md](8.DesignSystem.md) - Design System

## 1. Introdução

Este documento define as User Stories (US) do Projeto Bigtech, baseado na análise integrada dos documentos 1.Project.md, 2.Architecture.md, 3.Structure.md, 4.Entities.md e 5.Pages.md. As US cobrem todo o escopo do projeto, desde autenticação e consultas até gestão administrativa, garantindo cobertura completa do MVP e preparo para expansões. Cada US segue o formato padrão, com referências a entidades, páginas e funcionalidades relacionadas.

As US são priorizadas para o MVP (varejo), com extensões para atacado e administração. Elas promovem isolamento multi-tenant, extensibilidade via plugins e UX intuitiva.

## 2. User Stories

### US-001 - Autenticação de Usuário
**Como** usuário final  
**Quero** fazer login com CPF/CNPJ  
**Para** acessar minhas consultas e créditos de forma segura  
**Referência**: User (entidade)  
**Referência**: / (página dashboard, frontend-user)  
**Referência**: Autenticação via CORE (funcionalidade)  
**Endereço Fisico**: frontend-user/src/pages/_app.tsx  

**Criterios de Aceite:**
- [ ] Formulário solicita CPF/CNPJ e valida formato
- [ ] Autenticação via Appwrite JWT
- [ ] Redirecionamento automático para dashboard se logado
- [ ] Isolamento por tenant (tenantId)
- [ ] Logout limpa sessão e redireciona para login
- [ ] Tratamento de erros (credenciais inválidas)

### US-002 - Visualizar Dashboard de Usuário
**Como** usuário logado  
**Quero** ver meus créditos e consultas recentes  
**Para** gerenciar meu uso da plataforma  
**Referência**: User.credits, Consulta (entidades)  
**Referência**: / (página dashboard, frontend-user)  
**Referência**: Exibição de métricas (funcionalidade)  
**Endereço Fisico**: frontend-user/src/pages/index.tsx  

**Criterios de Aceite:**
- [ ] Exibe saldo de créditos (User.credits)
- [ ] Lista últimas 5 consultas (Consulta.status, Consulta.executedAt)
- [ ] Links para consultas e compras
- [ ] Atualização em tempo real via polling/SWR
- [ ] Responsivo para mobile/desktop
- [ ] Tema dark/light aplicado

### US-003 - Executar Consulta Crédito
**Como** usuário com créditos  
**Quero** consultar dados de crédito (ex.: POSITIVO ACERTA ESSENCIAL PF)  
**Para** obter informações normalizadas  
**Referência**: Consulta, Plugin (entidades)  
**Referência**: /consulta/credito (página, frontend-app)  
**Referência**: Execução via plugin consulta (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/consulta/credito.tsx  

**Criterios de Aceite:**
- [ ] Seleção de card de consulta de crédito disponível via plugins ativos (ex.: Infosimples)
- [ ] Execução debita créditos (User.credits - Consulta.cost)
- [ ] Resultado exibido em JSON normalizado (Consulta.output)
- [ ] Fallback para fonte alternativa se plugin falhar
- [ ] Histórico atualizado automaticamente
- [ ] Tratamento de erros (dados inválidos, sem créditos)
- [ ] Modal para input de dados (CPF/CNPJ) e confirmação

### US-004 - Executar Consulta Cadastral
**Como** usuário com créditos  
**Quero** consultar dados cadastrais (ex.: QUOD CADASTRAL PF)  
**Para** obter informações normalizadas  
**Referência**: Consulta, Plugin (entidades)  
**Referência**: /consulta/cadastral (página, frontend-app)  
**Referência**: Execução via plugin consulta (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/consulta/cadastral.tsx  

**Criterios de Aceite:**
- [ ] Seleção de card de consulta cadastral disponível via plugins ativos (ex.: Infosimples)
- [ ] Execução debita créditos (User.credits - Consulta.cost)
- [ ] Resultado exibido em JSON normalizado (Consulta.output)
- [ ] Fallback para fonte alternativa se plugin falhar
- [ ] Histórico atualizado automaticamente
- [ ] Tratamento de erros (dados inválidos, sem créditos)
- [ ] Modal para input de dados (CPF/CNPJ) e confirmação

### US-004.1 - Executar Consulta Veicular
**Como** usuário com créditos  
**Quero** consultar dados veiculares (ex.: BIN NACIONAL COMPLETA)  
**Para** obter informações normalizadas  
**Referência**: Consulta, Plugin (entidades)  
**Referência**: /consulta/veicular (página, frontend-app)  
**Referência**: Execução via plugin consulta (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/consulta/veicular.tsx  

**Criterios de Aceite:**
- [ ] Seleção de card de consulta veicular disponível via plugins ativos (ex.: Infosimples)
- [ ] Execução debita créditos (User.credits - Consulta.cost)
- [ ] Resultado exibido em JSON normalizado (Consulta.output)
- [ ] Fallback para fonte alternativa se plugin falhar
- [ ] Histórico atualizado automaticamente
- [ ] Tratamento de erros (placa inválida, sem créditos)
- [ ] Modal para input de dados (placa) e confirmação

### US-005 - Visualizar Relatório de Consultas
**Como** usuário logado  
**Quero** ver relatório de consumo de consultas  
**Para** revisar dados e controlar uso  
**Referência**: Consulta (entidade)  
**Referência**: /relatorios/consultas (página, frontend-app)  
**Referência**: Relatório e filtros (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/relatorios/consultas.tsx  

**Criterios de Aceite:**
- [ ] Relatório de consumo com filtros por data, tipo e status
- [ ] Detalhes expandidos (Consulta.input, Consulta.output)
- [ ] Exportação opcional (CSV/JSON)
- [ ] Isolamento por tenant (apenas consultas do usuário)
- [ ] Performance com lazy loading

### US-006 - Comprar Créditos
**Como** usuário logado  
**Quero** adquirir créditos via pagamento  
**Para** continuar executando consultas  
**Referência**: Billing, User.credits (entidades)  
**Referência**: /financeiro/comprar (página, frontend-app)  
**Referência**: Integração com plugin pagamento (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/financeiro/comprar.tsx  

**Criterios de Aceite:**
- [ ] Seleção de planos (créditos por valor)
- [ ] Integração com Asaas/Pagarme (plugin pagamentos/asaas)
- [ ] Confirmação via webhook atualiza User.credits
- [ ] Histórico de transações (Billing)
- [ ] Validação de pagamento antes de crédito
- [ ] Notificações de sucesso/erro
- [ ] Modal para confirmação de compra

### US-006.1 - Visualizar Extrato Financeiro
**Como** usuário logado  
**Quero** ver extrato de transações  
**Para** controlar gastos e pagamentos  
**Referência**: Billing (entidade)  
**Referência**: /financeiro/extrato (página, frontend-app)  
**Referência**: Listagem de transações (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/financeiro/extrato.tsx  

**Criterios de Aceite:**
- [ ] Lista de débitos/créditos (Billing.amount, Billing.status)
- [ ] Filtros por data e tipo
- [ ] Detalhes expandidos
- [ ] Isolamento por tenant

### US-006.2 - Gerenciar Boletos e Faturas
**Como** usuário logado  
**Quero** ver boletos pendentes/pagos  
**Para** acompanhar pagamentos  
**Referência**: Billing (entidade)  
**Referência**: /financeiro/boletos (página, frontend-app)  
**Referência**: Listagem e download (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/financeiro/boletos.tsx  

**Criterios de Aceite:**
- [ ] Lista de boletos com status
- [ ] Links para download
- [ ] Notificações de vencimento

### US-006.3 - Visualizar Aviso LGPD
**Como** usuário logado  
**Quero** ver informações de privacidade  
**Para** consentir e entender direitos  
**Referência**: N/A  
**Referência**: /lgpd (página, frontend-app)  
**Referência**: Página estática (funcionalidade)  
**Endereço Fisico**: frontend-app/src/pages/lgpd.tsx  

**Criterios de Aceite:**
- [ ] Texto de aviso LGPD
- [ ] Consentimento opcional
- [ ] Links para política completa

### US-007 - Autenticação de Administrador
**Como** administrador  
**Quero** fazer login no painel admin  
**Para** gerenciar tenants e plugins  
**Referência**: User (entidade, role admin)  
**Referência**: / (página dashboard, frontend-admin)  
**Referência**: Autenticação via CORE (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/_app.tsx  

**Criterios de Aceite:**
- [ ] Login com CPF/CNPJ e validação de role admin
- [ ] Redirecionamento para admin.bigtech.com.br
- [ ] Isolamento global (acesso a múltiplos tenants)
- [ ] Logout limpa sessão
- [ ] Tratamento de permissões insuficientes

### US-008 - Visualizar Dashboard Administrativo
**Como** administrador logado  
**Quero** ver métricas globais  
**Para** monitorar saúde da plataforma  
**Referência**: Tenant, Billing (entidades)  
**Referência**: / (página dashboard, frontend-admin)  
**Referência**: Métricas e gráficos (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/index.tsx  

**Criterios de Aceite:**
- [ ] Gráficos de tenants ativos, consumo total (Billing)
- [ ] Alertas de falhas/erros
- [ ] Links para gestão de tenants/plugins
- [ ] Atualização em tempo real
- [ ] Tema dark/light aplicado

### US-009 - Gerenciar Tenants
**Como** administrador  
**Quero** criar/editar tenants  
**Para** onboardar novos clientes  
**Referência**: Tenant (entidade)  
**Referência**: /tenants (página, frontend-admin)  
**Referência**: CRUD de tenants (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/tenants.tsx  

**Criterios de Aceite:**
- [ ] Lista de tenants com filtros (Tenant.status)
- [ ] Formulário para criar/editar (Tenant.name, Tenant.settings)
- [ ] Ativação/desativação de tenants
- [ ] Validação de unicidade (Tenant.name)
- [ ] Logs de auditoria (Audit)
- [ ] Isolamento visual por tenant

### US-010 - Gerenciar Plugins
**Como** administrador  
**Quero** ativar/desativar plugins por tenant  
**Para** customizar funcionalidades  
**Referência**: Plugin, Tenant (entidades)  
**Referência**: /plugins (página, frontend-admin)  
**Referência**: Ativação via pluginLoader (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/plugins.tsx  

**Criterios de Aceite:**
- [ ] Lista de plugins disponíveis/ativos por tenant
- [ ] Toggles para enable/disable (Plugin.status)
- [ ] Configuração de plugins (Plugin.config)
- [ ] Validação de dependências entre plugins
- [ ] Notificações de deploy/restart de containers
- [ ] Logs de mudanças (Audit)

**Notas de implementação (Docs-First / Traceability):**
- A API do CORE deve retornar um `auditId` para operações mutativas de plugin; a UI deve exibir o `auditId` no toast/modal de resultado para rastreabilidade.
- A UI deve seguir os padrões de `8.DesignSystem.md` seção `6.9 Componentes para Gestão de Plugins` para tabelas, modais e feedback de operações.
- Configurações de plugin devem ser validadas contra um schema (JSON Schema ou similar) antes de serem aplicadas; erros de validação devem ser mostrados ao administrador com orientação de correção.

### US-011 - Monitorar Billing
**Como** administrador  
**Quero** analisar transações globais  
**Para** controlar receita e uso  
**Referência**: Billing (entidade)  
**Referência**: /billing (página, frontend-admin)  
**Referência**: Relatórios e filtros (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/billing.tsx  

**Criterios de Aceite:**
- [ ] Relatórios por tenant/usuário (Billing.amount, Billing.status)
- [ ] Filtros por data, tipo e status
- [ ] Exportação para CSV/Excel
- [ ] Gráficos de receita/consumo
- [ ] Alertas de pagamentos pendentes
- [ ] Integração com reembolsos

**Notas de implementação (Docs-First / Traceability):**
- A API do CORE deve fornecer endpoints paginados para listagem de transações, endpoints de agregação por período e um endpoint de exportação (CSV/PDF) que respeite os filtros aplicados.
- Operações mutativas (ex.: reembolso/manual adjustment) devem retornar um `auditId` emitido pelo CORE; a UI deve exibir esse `auditId` após a operação.
- Exportação deve incluir `externalTransactionId` e `metadata` quando presente, e deve ser gerada pelo backend para garantir consistência.
- Regras de alerta (picos de consumo, múltiplas falhas) são configuráveis e devem gerar links para investigação via `auditId`.

### US-012 - Auditoria de Ações
**Como** administrador  
**Quero** ver logs de auditoria  
**Para** compliance e rastreamento  
**Referência**: Audit (entidade)  
**Referência**: / (página dashboard, frontend-admin, ou nova página)  
**Referência**: Geração automática de logs (funcionalidade)  
**Endereço Fisico**: frontend-admin/src/pages/audit.tsx (se criada)  

**Criterios de Aceite:**
- [ ] Lista de ações (Audit.action, Audit.timestamp)
- [ ] Filtros por tenant/usuário/recurso
- [ ] Detalhes expandidos (Audit.details)
- [ ] Exportação para auditoria externa
- [ ] Retenção permanente de logs
- [ ] Busca por IP/ação

## 3. Cobertura do Projeto

As US acima cobrem:
- **Autenticação e Acesso**: US-001, US-007
- **Funcionalidades de Usuário**: US-002 a US-006.3 (dashboard, consultas por categoria, relatórios, financeiro subdividido, LGPD)
- **Gestão Administrativa**: US-008 a US-011 (dashboard, tenants, plugins, billing)
- **Auditoria e Compliance**: US-012
- **MVP Focado**: Prioriza varejo; expansões (atacado) em US futuras.

## 4. Histórico de Versões
- **Versão 1.2** (21 de dezembro de 2025): Correção de inconsistência de nomenclatura, alterando "frontend-user" para "frontend-app" em todas as referências para alinhamento com 3.Structure.md e 5.Pages.md.- **Versão 1.1** (20 de dezembro de 2025): Refatoração baseada em 5.Pages.md v1.1. Atualização de US-003 a US-006 para categorias e novas rotas; adição de US-004.1, US-006.1 a US-006.3 para novas páginas.
- **Versão 1.0** (20 de dezembro de 2025): Criação inicial do documento 6.UserStories.md baseado em 1.Project.md a 5.Pages.md. Definição de US cobrindo todo o projeto com foco em MVP e isolamento multi-tenant.
- **Versão 1.3** (20 de dezembro de 2025): Atualização de US-003, US-004 e US-004.1 para incluir referência explícita a Infosimples como fonte em plugins ativos, alinhando com TASK-016.


Agora, precisamos criar o nosso 7.Tasks.md baseado nos documentos anteriores e nessas User Stories. Faça uma analise cuidadosa de todos os documentos para garantir que todas as tarefas necessárias sejam contempladas.Se o modelo a baixo para cada tasks criada:

## Tasks 
 - [ ] TASK-001. Título da Tarefa
   - Descrição detalhada da tarefa.
   - User Story Relacionada: US-XXX
   - Entidades: Lista de entidades relacionadas (ex.: User, Tenant)
   - Páginas: Lista de páginas relacionadas (ex.: /consulta/credito)
   - Funcionalidades: Lista de funcionalidades relacionadas (ex.: Autenticação, Execução de Consulta)
   - Endereço Físico: Caminho do arquivo ou módulo relevante (ex.: frontend-app/src/pages/consulta/credito.tsx)
   - _Requisitos: Lista de requisitos relacionados (ex.: 12.1, 12.2)

   - [ ] TASK-001.1 Escrever testes property-based para TASK-001
     - **Propriedade 1: Descrição da propriedade**
     - **Valida: Requisito XX.X**
