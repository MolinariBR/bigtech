
> backend-core@1.0.0 dev
> ts-node-dev --respawn --transpile-only src/index.ts

[INFO] 21:27:33 ts-node-dev ver. 2.0.0 (using ts-node ver. 10.9.2, typescript ver. 5.9.3)
üëÇ Handler subscribed to event: query.executed
üëÇ Handler subscribed to event: credits.purchased
üí∞ Billing Engine initialized
üì° Event Bus initialized
üîç Found plugin types: [ 'consulta', 'pagamentos' ]
üîç Found plugins in consulta: [ 'bigtech', 'infosimples' ]
üîç Checking plugin path: /home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts
üîÑ Importing plugin: consulta-bigtech
‚úÖ Plugin validation passed for: bigtech
‚úÖ Plugin loaded: consulta-bigtech v1.0.0
‚úÖ Plugin validation passed for: bigtech
‚úÖ Plugin loaded: consulta-bigtech v1.0.0
üîç Checking plugin path: /home/mau/projeto/consulta/backend/src/plugins/consulta/infosimples/index.ts
üîÑ Importing plugin: consulta-infosimples
‚úÖ Plugin validation passed for: infosimples
‚úÖ Plugin loaded: consulta-infosimples v1.0.0
‚úÖ Plugin validation passed for: infosimples
‚úÖ Plugin loaded: consulta-infosimples v1.0.0
üîç Found plugins in pagamentos: [ 'asaas' ]
üîç Checking plugin path: /home/mau/projeto/consulta/backend/src/plugins/pagamentos/asaas/index.ts
üîÑ Importing plugin: pagamentos-asaas
‚úÖ Plugin validation passed for: pagamento-asaas
‚úÖ Plugin loaded: pagamentos-asaas v1.0.0
‚úÖ Plugin validation passed for: pagamento-asaas
‚úÖ Plugin loaded: pagamentos-asaas v1.0.0
[DEV] Skipping active plugins load from database
‚úÖ Plugins infosimples e bigtech ativados por padr√£o
üì° Event Bus initialized
üí∞ Billing Engine initialized
‚úÖ CORE initialized successfully
üöÄ BigTech CORE running on port 8080
üìä Health check: http://localhost:8080/health
[auth.login] MODO TESTE: Pulando valida√ß√£o do Appwrite Accounts
AuditLogger: created audit document {
  tenantId: 'default',
  userId: 'user-bigtech',
  action: 'user_login',
  resource: 'user:user-bigtech',
  details: '{"email":"user@bigtech.com"}',
  ipAddress: 'system',
  timestamp: '2025-12-27T00:29:09.415+00:00',
  '$id': '694f28556b763334405e',
  '$permissions': [],
  '$createdAt': '2025-12-27T00:29:09.440+00:00',
  '$updatedAt': '2025-12-27T00:29:09.440+00:00',
  '$sequence': 1813,
  '$databaseId': 'bigtechdb',
  '$collectionId': 'audits'
}
[pluginAccess.middleware] MODO DESENVOLVIMENTO: Permitindo acesso ao plugin: bigtech
‚ö†Ô∏è Falha no servi√ßo 11-serasa-consumidor: Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA.
‚ùå Erro na execu√ß√£o BigTech: Error: Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA.
    at BigTechPlugin.normalizeResponse (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:755:13)
    at BigTechPlugin.executeWithFallbacks (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:1413:41)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at BigTechPlugin.execute (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:92:22)
    at PluginLoader.executePlugin (/home/mau/projeto/consulta/backend/src/core/pluginLoader.ts:196:16)
    at /home/mau/projeto/consulta/backend/src/controllers/plugins.ts:68:20
AuditLogger: created audit document {
  tenantId: 'default',
  userId: 'user-bigtech',
  action: 'plugin_execute',
  resource: 'plugin:bigtech',
  details: '{"pluginId":"bigtech","input":{"serviceCode":"11-serasa-consumidor","cpfCnpj":"09469124677","tipoPessoa":"F"},"success":false,"cost":0,"duration":7401,"error":"Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA."}',
  ipAddress: 'system',
  timestamp: '2025-12-27T00:29:21.214+00:00',
  '$id': '694f286140b17046d92e',
  '$permissions': [],
  '$createdAt': '2025-12-27T00:29:21.265+00:00',
  '$updatedAt': '2025-12-27T00:29:21.265+00:00',
  '$sequence': 1814,
  '$databaseId': 'bigtechdb',
  '$collectionId': 'audits'
}
[pluginAccess.middleware] MODO DESENVOLVIMENTO: Permitindo acesso ao plugin: bigtech
‚ö†Ô∏è Falha no servi√ßo 11-serasa-consumidor: Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA.
‚ùå Erro na execu√ß√£o BigTech: Error: Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA.
    at BigTechPlugin.normalizeResponse (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:755:13)
    at BigTechPlugin.executeWithFallbacks (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:1413:41)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at BigTechPlugin.execute (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:92:22)
    at PluginLoader.executePlugin (/home/mau/projeto/consulta/backend/src/core/pluginLoader.ts:196:16)
    at /home/mau/projeto/consulta/backend/src/controllers/plugins.ts:68:20
AuditLogger: created audit document {
  tenantId: 'default',
  userId: 'user-bigtech',
  action: 'plugin_execute',
  resource: 'plugin:bigtech',
  details: '{"pluginId":"bigtech","input":{"serviceCode":"11-serasa-consumidor","cpfCnpj":"09469124677","tipoPessoa":"F"},"success":false,"cost":0,"duration":6868,"error":"Consulta falhou: NAO EXISTEM PARAMETROS PARA PESQUISA. OPERACAO IMPEDIDA."}',
  ipAddress: 'system',
  timestamp: '2025-12-27T00:29:43.155+00:00',
  '$id': '694f2877325a9037e873',
  '$permissions': [],
  '$createdAt': '2025-12-27T00:29:43.206+00:00',
  '$updatedAt': '2025-12-27T00:29:43.206+00:00',
  '$sequence': 1815,
  '$databaseId': 'bigtechdb',
  '$collectionId': 'audits'
}
[auth.me.plugins] User authenticated: user-bigtech
[auth.me.plugins] User data: { id: 'user-bigtech', allowedPlugins: '["bigtech"]' }
[auth.me.plugins] activeTenantPluginIds from pluginLoader: [ 'infosimples', 'bigtech' ]
[auth.me.plugins] userAllowedPlugins: [ 'bigtech' ]
[auth.me.plugins] allowedPlugins: [ 'bigtech' ]
[auth.me.plugins] Searching for plugin bigtech in database
[auth.me.plugins] Found 0 documents for plugin bigtech
[auth.me.plugins] No documents found for plugin bigtech, returning mock data
[auth.me.plugins] pluginsDetails: [
  {
    id: 'bigtech',
    name: 'BigTech Consultas',
    type: 'consulta',
    config: {}
  }
]
[auth.me.plugins] User authenticated: user-bigtech
[auth.me.plugins] User data: { id: 'user-bigtech', allowedPlugins: '["bigtech"]' }
[auth.me.plugins] activeTenantPluginIds from pluginLoader: [ 'infosimples', 'bigtech' ]
[auth.me.plugins] userAllowedPlugins: [ 'bigtech' ]
[auth.me.plugins] allowedPlugins: [ 'bigtech' ]
[auth.me.plugins] Searching for plugin bigtech in database
[pluginAccess.middleware] MODO DESENVOLVIMENTO: Permitindo acesso ao plugin: bigtech
[auth.me.plugins] Found 0 documents for plugin bigtech
[auth.me.plugins] No documents found for plugin bigtech, returning mock data
[auth.me.plugins] pluginsDetails: [
  {
    id: 'bigtech',
    name: 'BigTech Consultas',
    type: 'consulta',
    config: {}
  }
]
[pluginAccess.middleware] MODO DESENVOLVIMENTO: Permitindo acesso ao plugin: bigtech
[pluginAccess.middleware] MODO DESENVOLVIMENTO: Permitindo acesso ao plugin: bigtech
‚ùå Erro na execu√ß√£o BigTech: ValidationError: CPF √© obrigat√≥rio
    at Validator.validateInput (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/validator.ts:78:13)
    at BigTechPlugin.execute (/home/mau/projeto/consulta/backend/src/plugins/consulta/bigtech/index.ts:86:22)
    at PluginLoader.executePlugin (/home/mau/projeto/consulta/backend/src/core/pluginLoader.ts:196:29)
    at /home/mau/projeto/consulta/backend/src/controllers/plugins.ts:68:39
    at Layer.handle [as handle_request] (/home/mau/projeto/consulta/backend/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/mau/projeto/consulta/backend/node_modules/express/lib/router/route.js:149:13)
    at /home/mau/projeto/consulta/backend/src/middleware/pluginAccess.ts:20:16
    at pluginAccessMiddleware (/home/mau/projeto/consulta/backend/src/controllers/plugins.ts:36:10)
    at Layer.handle [as handle_request] (/home/mau/projeto/consulta/backend/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/mau/projeto/consulta/backend/node_modules/express/lib/router/route.js:149:13) {
  field: 'input'
}
AuditLogger: created audit document {
  tenantId: 'default',
  userId: 'user-bigtech',
  action: 'plugin_execute',
  resource: 'plugin:bigtech',
  details: '{"pluginId":"bigtech","input":{"serviceCode":"1539-bvs-basica-pf","cpfCnpj":"09469124677","tipoPessoa":"F"},"success":false,"cost":0,"duration":13,"error":"CPF √© obrigat√≥rio"}',
  ipAddress: 'system',
  timestamp: '2025-12-27T00:30:43.643+00:00',
  '$id': '694f28b3a2180cd8f28a',
  '$permissions': [],
  '$createdAt': '2025-12-27T00:30:43.666+00:00',
  '$updatedAt': '2025-12-27T00:30:43.666+00:00',
  '$sequence': 1816,
  '$databaseId': 'bigtechdb',
  '$collectionId': 'audits'
}
